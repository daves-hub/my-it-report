name: Build and Release LaTeX Report

on:
  push:
    tags:
      - "v*"        # Only run when you push a version tag (e.g. v1.0)
  workflow_dispatch: # Allow manual runs if needed

permissions:
  contents: write    # Needed for GitHub Releases

jobs:
  build_latex:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. Setup TeX Live (lean + cached)
      - name: Setup TeX Live
        uses: TeX-Live/setup-texlive-action@v3
        with:
          cache: true
          packages: >
            scheme-medium
            latexmk
            geometry
            graphicx
            hyperref
            setspace
            titlesec
            tocloft
            fancyhdr
            microtype
            xcolor
            listings

      # 3. Compile LaTeX document
      - name: Compile LaTeX
        run: |
          latexmk -pdf \
            -file-line-error \
            -halt-on-error \
            -interaction=nonstopmode \
            report.tex

      # 4. Upload PDF to GitHub Release
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: report.pdf
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
